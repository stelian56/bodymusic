<html>
<head>
<script src="../js/jquery-2.1.1.js"></script>
</head>

<body>
<p><button onclick="play()">Play</button></p>
</body>

<script type="text/javascript">

var contextClass = window.AudioContext || window.webkitAudioContext;
var context = new contextClass();
var frequency = 440;
var attack = 0.001
var release = 0.5;
var spacing = 0.5;
var checkInterval = 0.025;
var lookahead = 0.05;
var playFlag, lastNote;

var scheduleNote = function() {
    var currentTime = context.currentTime;
    var tick = Math.floor((currentTime + lookahead)/spacing);
    if (Math.floor(currentTime/spacing) < tick) {
        time = tick*spacing;
        if (lastNote) {
            lastNote.stop(time);
        }
        var note = context.createOscillator();
        note.frequency.setValueAtTime(frequency, time);
        var envelope = context.createGain();
        envelope.gain.setValueAtTime(0, time);
        envelope.gain.setTargetAtTime(1, time, attack);
        envelope.gain.setTargetAtTime(0, time + attack, release);
        note.connect(envelope);
        envelope.connect(context.destination);
        note.start(time);
        lastNote = note;
        playFlag = false;
    }
};


var play = function() {
    playFlag = true;
};

setInterval(function() {
    if (playFlag) {
        var currentTime = context.currentTime;
        var tick = Math.floor((currentTime + lookahead)/spacing);
        if (Math.floor(currentTime/spacing) < tick) {
            scheduleNote(tick*spacing);
        }
        playFlag
        
    }
}, checkInterval*1000);

</script>

</html>
